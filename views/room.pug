doctype html
html
    head
        meta(charset='UTF-8')
        link(rel="stylesheet" href="../stylesheets/style.css")
        title
    body
        input(id = "url" value = room)
        button 
                a(href="/room_exit") exit
        div(id = 'chat-main')
            div(id = 'chat')
            div
                input(type="text" id ="test")
                button(onclick="send()") send

            script(src="/socket.io/socket.io.js")
            script.
                const socket = io();
                const room = '!{room}';
                const name = `!{user}`;
                socket.on('connect', ()=> {
                    socket.emit('joinroom', {room: '!{room}'});
                    const data = {name : name, room: '!{room}'};
                    socket.emit('newUser', data);
                });

                socket.on('update',(data) => {
                    const chat = document.getElementById('chat');
                    const message = document.createElement('div');
                    const node = document.createTextNode(`${data.name} : ${data.message}`);
                    let className = '';
                    switch(data.type) {
                        case 'message':
                        className = 'other'
                        break

                        case 'connect':
                        className = 'connect'
                        break

                        case 'disconnect':
                        className = 'disconnect'
                        break
                    }
                    message.classList.add(className);
                    message.appendChild(node);
                    chat.appendChild(message);
                });


                function send() {
                    let message = document.getElementById('test').value;
                    document.getElementById('test').value = '';
                    var chat = document.getElementById('chat')
                    var msg = document.createElement('div');
                    var node = document.createTextNode(message);
                    msg.classList.add('me');
                    msg.appendChild(node);
                    chat.appendChild(msg);
                    socket.emit('message',{type : 'message', message : message, room : room});
                };
